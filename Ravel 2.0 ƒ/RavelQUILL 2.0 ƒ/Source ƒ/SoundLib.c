#include <Sound.h>#include "SoundLib.h"//#include <UniversalCompiler.h>#define kWaitIfFull TRUE		// wait for room in queue#define kSoundComplete  1	// last command in channel;  Application definedstatic SndChannelPtr mySndChan;static Boolean needFreeChannel;static pascal void CallBackRoutine (SndChannelPtr chan, SndCommand cmd);static void IsAlreadyPlayed (void);static OSErr InstallCallBack (SndChannelPtr);static UniversalProcPtr upp = 0;extern	Boolean	doSound;static OSErr InstallCallBack (SndChannelPtr mySndChan){	SndCommand mySndCmd;	mySndCmd.cmd = callBackCmd;	mySndCmd.param1 = kSoundComplete;	mySndCmd.param2 = SetCurrentA5();	return (SndDoCommand (mySndChan, &mySndCmd, kWaitIfFull));}static pascal void CallBackRoutine (SndChannelPtr theChan, SndCommand theCmd){#pragma unused (theChan)	long myA5;	if  (theCmd.param1 == kSoundComplete) {		myA5 = SetA5 (theCmd.param2);		needFreeChannel = TRUE;		myA5 = SetA5 (myA5);	}}void NeedFreeChannel (){	if (needFreeChannel) {		SndDisposeChannel (mySndChan, 0);		needFreeChannel = false;	}}void InitSoundLib (){	mySndChan = 0;	needFreeChannel = false;	SndSetSysBeepState (sysBeepEnable);}void IsAlreadyPlayed (){	if (mySndChan) {#if powerc		if (upp)			DisposeRoutineDescriptor (upp);		upp = 0;#endif		SndDisposeChannel (mySndChan, true);		mySndChan = 0;	}	needFreeChannel = false;}void CallSndPlay (short mySndID){	Handle 		mySndHandle;	OSErr 		myErr;	if (!doSound)		return;	IsAlreadyPlayed ();	mySndHandle = GetResource ('snd ', mySndID);	if (mySndHandle != nil) {#if powerc		upp = NewRoutineDescriptor ((ProcPtr) CallBackRoutine, uppSndCallBackProcInfo, GetCurrentISA ());#else		upp = (UniversalProcPtr) CallBackRoutine;#endif				SndNewChannel (&mySndChan, sampledSynth, initMono, (SndCallBackUPP) upp);		needFreeChannel = false;		myErr = SndPlay (mySndChan, (SndListHandle) mySndHandle, TRUE);		InstallCallBack (mySndChan);	}}void CallASndPlay (short mySndID){	Handle 		mySndHandle;	OSErr 		myErr;	if (!doSound)		return;	IsAlreadyPlayed ();	mySndHandle = GetResource ('snd ', mySndID);	if (mySndHandle != nil) {		SndNewChannel (&mySndChan, sampledSynth, initMono, NULL);		needFreeChannel = false;		myErr = SndPlay (mySndChan, (SndListHandle)  mySndHandle, FALSE);		SndDisposeChannel (mySndChan, 0);		mySndChan = 0;	}}