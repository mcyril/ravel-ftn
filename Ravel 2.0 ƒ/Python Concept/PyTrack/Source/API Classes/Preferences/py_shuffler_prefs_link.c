//	¥	py_shuffler_prefs_link.c#include "py_shuffler_prefs_link.h"#include "PascalStr.h"#include <extras.h>static voidpreflink_dealloc(PyPrefLinkObject *v){	_Py_Dealloc(v->Addr);	_Py_Dealloc(v->yourAka);	PyObject_Del(v);}static intpreflink_init(PyPrefLinkObject *v, PyObject *args, PyObject *kwds){	v->nodeName[0] = 0;		// Node Name	v->nodePhone[0] = 0;		// Node phone address	v->evt_mask = 0;		// Operable time	v->nodeflags = 0;		// 32-bits	v->Addr = NULL;			// Node address	v->yourAka = NULL;		// Use your aka with this node	memset (v->ArcMail_pwd, 0, 16);	// ArcMail password	memset (v->AreaFix_pwd, 0, 16);	// AreaFix password	memset (v->Session_pwd, 0, 16);	// Session password	v->Compressor = 0;		// Compressor number	v->Poll = 0;			// Poll type	memset (v->group, 0, 64);		// Available list	return 0;}static PyObject *preflink_getattr(PyPrefLinkObject *v, char *name){	if (strcmp(name, "name") == 0)		return PyString_FromStringAndSize((char *)&v->nodeName[1], v->nodeName[0]);	else if (strcmp(name, "phone") == 0)		return PyString_FromStringAndSize((char *)&v->nodePhone[1], v->nodePhone[0]);	else if (strcmp(name, "arcmail_pwd") == 0)		return PyString_FromString(v->ArcMail_pwd);	else if (strcmp(name, "areafix_pwd") == 0)		return PyString_FromString(v->AreaFix_pwd);	else if (strcmp(name, "session_pwd") == 0)		return PyString_FromString(v->Session_pwd);	else if (strcmp(name, "groups") == 0)		return PyString_FromString(v->group);	else if (strcmp(name, "address") == 0)	{		Py_XINCREF(v->Addr);		return v->Addr;	}	else if (strcmp(name, "useaka") == 0)	{		Py_XINCREF(v->yourAka);		return v->yourAka;	}	else if (strcmp(name, "candialevent") == 0)		return PyInt_FromLong(v->evt_mask);	else if (strcmp(name, "flags") == 0)		return PyInt_FromLong(v->nodeflags);	else if (strcmp(name, "compressortype") == 0)		return PyInt_FromLong(v->Compressor);	else if (strcmp(name, "polltype") == 0)		return PyInt_FromLong(v->Poll);	return NULL;}static intpreflink_setattr(PyPrefLinkObject *v, char *name, PyObject *content){	int res = -1;	return res;}static PyPrefLinkObject *preflink_new_ex(void){	PyPrefLinkObject *res = PyObject_New(PyPrefLinkObject, &PyShufflerPrefLink_Type);	if (res != NULL)		preflink_init(res, NULL, NULL);	return res;}static PyObject *preflink_repr(PyPrefLinkObject *v){	return PyString_FromStringAndSize((char *)&v->nodeName[1], v->nodeName[0]);}PyTypeObject PyShufflerPrefLink_Type = {	PyObject_HEAD_INIT(&PyType_Type)	0,	"link",	sizeof(PyPrefLinkObject),	0,	(destructor)preflink_dealloc,						/* tp_dealloc */	0,					/* tp_print */	(getattrfunc)preflink_getattr,						/* tp_getattr */	0 /*(setattrfunc)preflink_setattr*/,						/* tp_setattr */	0,					/* tp_compare */	(reprfunc)preflink_repr,						/* tp_repr */	0,					/* tp_as_number */	0,					/* tp_as_sequence */	0,					/* tp_as_mapping */	0,					/* tp_hash */	0,					/* tp_call */	0,					/* tp_str */	0,					/* tp_getattro */	0,					/* tp_setattro */	0,					/* tp_as_buffer */	Py_TPFLAGS_DEFAULT,	/* tp_flags */	0,					/* tp_doc */	0,					/* tp_traverse */	0,					/* tp_clear */	0,					/* tp_richcompare */	0,					/* tp_weaklistoffset */	0,					/* tp_iter */	0,					/* tp_iternext */	0,					/* tp_methods */	0,					/* tp_members */	0,					/* tp_getset */	0,					/* tp_base */	0,					/* tp_dict */	0,					/* tp_descr_get */	0,					/* tp_descr_set */	0,					/* tp_dictoffset */	0,					/* tp_init */	0,					/* tp_alloc */	0,					/* tp_new */};PyObject *PyShufflerPrefLinks_Create(plugsPrefs *pp){	short	i, j;	PyObject *res;	res = PyList_New(pp->NodesNumber);	for (i = 0; i < pp->NodesNumber; i++)	{		PyPrefLinkObject *link = preflink_new_ex();		if(link != NULL)		{			pStrCopy((**pp->nodesHndls[i]).nodeName, link->nodeName);			pStrCopy((**pp->nodesHndls[i]).nodePhone, link->nodePhone);			link->evt_mask = (**pp->nodesHndls[i]).evt_mask;			link->nodeflags = (**pp->nodesHndls[i]).nodeflags;			link->Compressor = (**pp->nodesHndls[i]).Compressor;			link->Poll = (**pp->nodesHndls[i]).Poll;						memcpy(link->ArcMail_pwd, (**pp->nodesHndls[i]).ArcMail_pwd, 8);			memcpy(link->AreaFix_pwd, (**pp->nodesHndls[i]).AreaFix_pwd, 8);			memcpy(link->Session_pwd, (**pp->nodesHndls[i]).Session_pwd, 8);						for (j = 0; j < __min(63, (**pp->nodesHndls[i]).GroupsNumber); j++)				link->group[j] = (**pp->nodesHndls[i]).group[j] + 'A';						link->Addr = PyFtnAddr_NewAddr(&(**pp->nodesHndls[i]).Addr);			link->yourAka = ((**pp->nodesHndls[i]).yourAka == 0) ?					PyFtnAddr_NewAddr(&(**pp->homesystem).mainAddr.ad) :					PyFtnAddr_NewAddr(&(**pp->homesystem).AKAAddr[(**pp->nodesHndls[i]).yourAka - 1].ad);						PyList_SetItem(res, i, (PyObject *)link);		}	}	Py_XINCREF(res);	return res;}