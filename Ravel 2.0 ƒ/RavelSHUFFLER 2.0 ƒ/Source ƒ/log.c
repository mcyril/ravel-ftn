#include <Sound.h>#include <stdio.h>#include <stdarg.h>#include <string.h>#include <QDOffscreen.h>#include "log.h"#include "ravel_msg_base.h"//#include "Ravel_FTN.h"#include "Ravel_Prefs.h"#include "Pathes.h"static	FILE	*mylog;	// Offscreen world variablesstatic	GWorldPtr		currPort;static	GDHandle		currDev;static	GWorldPtr		gMyOffG;static	Rect			rBounds, iRect, tRect;extern	DialogPtr		RavelWindow;void openlog ( void ){	Handle	iHandle;	short	iType;		logPath[logPath[0]+1] = 0;	mylog = fopen ( (char *) &logPath[1], "a" );	if (!mylog)	{		SysBeep (10);		ExitToShell ();	}	fprintf ( mylog, "\n" );	fclose ( mylog );	GetGWorld ( &currPort, &currDev );		GetDialogItem ( RavelWindow, 5, &iType, &iHandle, &iRect );	SetRect ( &rBounds, 0, 0, iRect.right-iRect.left, iRect.bottom-iRect.top );	SetRect ( &tRect, 0, rBounds.bottom-11, rBounds.right, rBounds.bottom );		NewGWorld ( &gMyOffG, 1, &rBounds, nil, nil, 0 );	SetGWorld ( gMyOffG, nil );	SetPort ( (GrafPtr) gMyOffG );	TextFont ( 4 );	TextSize ( 9 );	PenPat ( &qd.black );	ForeColor ( blackColor );	EraseRect ( &rBounds );	SetGWorld (currPort, currDev);	SetPort ( RavelWindow );	CopyBits ( (BitMap *) (*(gMyOffG->portPixMap)),						&((GrafPtr)RavelWindow)->portBits, &rBounds, &iRect, srcCopy, nil);}void _putlog ( char status, char *loginfo ){	putlog (status, "%s", loginfo);}void putlog ( char status, char *loginfo, ... ){	va_list		va;	char		tmp[1024], t[1024];	DateTimeRec	dtr;			if (status == '~')		return;		va_start ( va, loginfo );	vsprintf ( tmp, loginfo, va );	va_end ( va );	GetTime (&dtr);		mylog = fopen ( (char *) &logPath[1], "a" );	if (!mylog)	{		SysBeep (10);		ExitToShell ();	}	sprintf ( t, "%1c %.2d/%.2d %.2d:%.2d:%.2d SHFL %s",											status, 											dtr.day, dtr.month,											dtr.hour, dtr.minute,											dtr.second, tmp );	fprintf ( mylog, "%s\n", t );		SetGWorld ( gMyOffG, nil );	SetPort ( (GrafPtr) gMyOffG );	ScrollRect ( &rBounds, 0, -11, NULL );	EraseRect ( &tRect );	MoveTo ( rBounds.left, rBounds.bottom-2 );	DrawText ( t, 0, strlen (t) );	SetGWorld (currPort, currDev);	SetPort ( RavelWindow );	CopyBits ( (BitMap *) (*(gMyOffG->portPixMap)),						&((GrafPtr)RavelWindow)->portBits, &rBounds, &iRect, srcCopy, nil);		fclose ( mylog );	FlushVol ( NULL, 0 );}void updtlog (){	SetPort ( RavelWindow );	CopyBits ( (BitMap *) (*(gMyOffG->portPixMap)),						&((GrafPtr)RavelWindow)->portBits, &rBounds, &iRect, srcCopy, nil);	}void closelog ( void ){}