#include <stdio.h>#include <string.h>#include "ravel_msg_base.h"#include "Ravel_Prefs.h"#include "stringutl.h"#include "What.h"#include "Plug-Ins.h"char	*command[] = {						"NETPACK",						"TOSS",						"SCAN",						"LINK",						"PURGE",						"PACK",						"UNDEL",						"REMIND",						"IMPORT",						"WAIT",						"QUIT",						"" };QHdr	cmdList;short	DoIt;				// ¥ What we must do now.Str255	DoItName;			// ¥ (if DoIt == -1 -> custom call name)typedef struct _window {	struct _window	*qLink;	short			qType;	short			command;	char			cmdname[16];} cmdQEl, *cmdQElPtr;void InitCommand (void){	cmdList.qFlags = 0;	cmdList.qHead = NULL;	cmdList.qTail = NULL;}void EnqueueCommand (short doit){	cmdQElPtr	what;	what = (cmdQElPtr) cmdList.qHead;		while (what)	{		if (what->command == doit)			return;		what = what->qLink;	}	what = (cmdQElPtr) NewPtrClear (sizeof (cmdQEl));		what->command = doit;	strncpy (what->cmdname, (char *) &DoItName[1], 15);		Enqueue ((QElemPtr) what, &cmdList);}short DequeueCommand (Boolean killhead){	short		res = 0;				//	res = 0, do nothing	cmdQElPtr	what;	what = (cmdQElPtr) cmdList.qHead;	if (what)	{		res = what->command;		strcpy ((char *) &DoItName[1], what->cmdname);		DoItName[0] = strlen ((char *) &DoItName[1]);				if (killhead)		{			Dequeue ((QElemPtr) what, &cmdList);			DisposePtr ((Ptr) what);		}				if (res == _QUIT && cmdList.qHead != NULL)			res = 0;	}		return res;}Boolean ParseCommand (void){	FILE			*what;	Boolean			result = false, found;	char			st[128], buff[512];	plugsChainPtr	plug;			what = fopen ( "Ravel.What", "r" );	if (what)	{		while (fgets(buff, 510, what) != NULL)		{			found = false;					if (sscanf (buff, "%s", st) != 1)				break;						for (DoIt=0; ; DoIt++)				if (command[DoIt][0])				{					if (!strcasecmp ( st, command[DoIt] ))						break;				}				else					break;								if (command[DoIt][0])			{				DoIt++;				result = true;				found = true;			}			else			{			//	¥	look for plugs name							if (plugsChain)				{					plug = plugsChain;										DoIt = -1;					strncpy ((char *) &DoItName[1], st, 15);					DoItName[0] = strlen ((char *) &DoItName[1]);					result = true;					found = true;				}			}			if (found)				EnqueueCommand(DoIt);		}		fclose (what);			FSDelete ("\pRavel.What", 0);	}	return result;}