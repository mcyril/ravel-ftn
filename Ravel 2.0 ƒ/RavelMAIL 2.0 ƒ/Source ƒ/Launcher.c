#include "Launcher.h"#include "Pathes.h"#include "log.h"void ApplicationLaunchAndWaitTermination ( StringPtr ApplPathName ){	short				iErr;	EventRecord			theEvent;	LaunchParamBlockRec	myLaunchParams;	FSSpec				spec;	ProcessSerialNumber	launchedProcessSN;	RgnHandle			myRgn;	ProcessInfoRecPtr	ProcessInfo;	myRgn = NewRgn ();	putlog ( lgATTN, "Try sublaunch %s.", &ApplPathName[1] );	if ( FSMakeFSSpec ( 0, 0, ApplPathName, &spec ) )	{		putlog ( lgALRT, "Application %s not found.", &ApplPathName[1] );			return;	}	myLaunchParams.launchBlockID = extendedBlock;	myLaunchParams.launchEPBLength = extendedBlockLen;	myLaunchParams.launchFileFlags = 0;	myLaunchParams.launchControlFlags = launchContinue + launchNoFileFlags;	myLaunchParams.launchAppSpec = &spec;	myLaunchParams.launchAppParameters = NULL;	iErr = LaunchApplication ( &myLaunchParams );	if (!iErr)		launchedProcessSN = myLaunchParams.launchProcessSN;	else	{		putlog ( lgALRT, "Launch failed with errCode=%d.", iErr );			return;	}		ProcessInfo = (ProcessInfoRecPtr) NewPtr (sizeof(ProcessInfoRec));	ProcessInfo->processInfoLength = sizeof(ProcessInfoRec);	ProcessInfo->processName = NULL;	ProcessInfo->processAppSpec = NULL;		iErr = GetProcessInformation ( &launchedProcessSN, ProcessInfo );		while ( iErr == noErr )		if ( WaitNextEvent ( everyEvent, &theEvent, 120, myRgn ) )		{			switch (theEvent.what)			{			case kHighLevelEvent:				if ( theEvent.message == kCoreEventClass &&					 *((long *) &theEvent.where) == kAEApplicationDied )				{					ProcessInfo->processInfoLength = sizeof(ProcessInfoRec);					ProcessInfo->processName = NULL;					ProcessInfo->processAppSpec = NULL;					iErr = GetProcessInformation ( &launchedProcessSN, ProcessInfo );				}				else					iErr = AEProcessAppleEvent ( &theEvent );								break;			}		}		DisposPtr ( (Ptr) ProcessInfo );	putlog ( lgATTN, "Sublaunch complete." );}