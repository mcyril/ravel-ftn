#include "ravel_msg_base.h"#include "ravel_asciiz.h"#include "lzss.h"//	get_ASCIIZ - string m.b. less than 256!Boolean get_ASCIIZ (short fromfile, char *dest, long limit){	char		buff[256];	long		counter, oldPos;	short		i;	GetFPos (fromfile, &oldPos);		counter = limit + 1;	FSRead ( fromfile, &counter, &buff );		for ( i=0; i<counter; i++ )	{		if (buff[i])			dest[i] = buff[i];		else			break;					if ( i >= limit )		{			i = 0;			break;		}	}		dest[i] = 0;//	SetFPos (fromfile, fsFromStart, oldPos);//	SetFPos (fromfile, fsFromMark, i+1);	SetFPos (fromfile, fsFromStart, oldPos+i+1);		return true;}Boolean get_msg_text ( short fromfile, Handle dest ){	long			counter;	msgbase_text	txt;	Handle			h;	buff_desc		src, dst;			counter = sizeof (msgbase_text);	if (FSRead (fromfile, &counter, &txt))	{		return false;	}		if (txt.text_sign == 'PL')	{		SetHandleSize (dest, txt.text_length);		HLock (dest);				counter = txt.text_length;		FSRead (fromfile, &counter, *dest);				HUnlock (dest);	}	else		if (txt.text_sign == 'LZ')		{			h = NewHandle (txt.text_len_cmp);			MoveHHi (h);			HLock (h);						src.buff = (unsigned char *) *h;			src.len = txt.text_len_cmp;			src.point = 0L;						SetHandleSize (dest, txt.text_length);			HLock (dest);						dst.buff = (unsigned char *) *dest;			dst.len = txt.text_length;			dst.point = 0L;			counter = txt.text_len_cmp;			FSRead (fromfile, &counter, *h);						LZSSDecode (&src, &dst);			HUnlock (dest);			DisposeHandle (h);		}		else			if (txt.text_sign == '6P')			{				h = NewHandle (txt.text_len_cmp);				MoveHHi (h);				HLock (h);								src.buff = (unsigned char *) *h;				src.len = txt.text_len_cmp;				src.point = 0L;								SetHandleSize (dest, txt.text_length);				HLock (dest);								dst.buff = (unsigned char *) *dest;				dst.len = txt.text_length;				dst.point = 0L;				counter = txt.text_len_cmp;				FSRead (fromfile, &counter, *h);								SIXDecode (&src, &dst);				HUnlock (dest);				DisposeHandle (h);			}			else				DebugStr ("\pUNSUPPORTED COMPRESSION");		return true;}Boolean get_pkt_text ( short fromfile, Handle dest ){	char		buff[4096];	long		counter, pos, i;		SetHandleSize ( dest, 0L );	pos = 0L;		do {				counter = 4096L;		FSRead ( fromfile, &counter, buff );		if ( counter )		{			for ( i=0; i<counter; i++ )				if (!buff[i])					break;						SetHandleSize ( dest, pos+i );			BlockMove ( buff, *dest+pos, i );			pos += i;						if ( i < counter )				break;		}	} while (counter);	SetHandleSize ( dest, pos+1 );	*((char *)(*dest+pos)) = 0;	SetFPos ( fromfile, fsFromMark, -(counter-i-1) );	return true;}