/*•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••	Copyright © 1996-1997 Wicked Cyril		При использовании исходных текстов SDK указание Copyright © 1996 Cyril Moorzin		обязательно.		Так же при генерации писем обязательно упоминание название пакета Ravel в tearline.				Ravel SDK поставляется в виде "as is". Автор не несет ответственности за		несовместимость Plug-Ins в будущих версиях RavelSHUFFLER при использовании		undewater приемов программирования.				Не существует НИКАКОЙ документации по Ravel SDK.		Так же автор пока отказался от распространения исходных текстов не только работы		с базой сообщений, но и старых релизов RavelQUILL.  •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••*/#include <string.h>#include <stdio.h>#include <A4Stuff.h>#include "ravel_msg_base.h"#include "Ravel_Prefs.h"#include "PascalStr.h"#include "Ravel_PlugIns.h"static char *greate = "Your message has been successfuly received.\xD";static char *greate1 = "Your message has been routed via this system.\xD";static char *tln = "\xD--- " SHUFFLERNAME " " RAVELVERS "\xD";		char	local_area[256];		char	nametocmp[128];		addr	forward;void ReadTemplates (StringPtr prefname, PlugsControlPtr plugcontrol);void main (PlugsControlPtr plugcontrol){	Boolean		res, a1, a2;	short		ownFile, oldRes, i;	Handle		h;	addr		tmpaddr;	pktmsg		*m;	DateTimeRec	dtr;	char		stemp[64], stemp1[64], stmp[128];	Str255		plugcfg;	EnterCodeResource ();	switch (plugcontrol->opCode)	{	case plugWelcome:		//	StartUp call of plug-ins. We make order and init. prefs.		local_area[0] = 0;		forward.zone = -1;		pStrCopy (plugcontrol->thisplugPath, plugcfg);		pStrConc (plugcfg, "\p.cfg", plugcfg);		ReadTemplates (plugcfg, plugcontrol);		//••				(*(plugcontrol->Preferences.homesystem))->sysop[(*(plugcontrol->Preferences.homesystem))->sysop[0]+1] = 0;		strcpy (nametocmp, (char *) &(*(plugcontrol->Preferences.homesystem))->sysop[1]);		if (local_area[0] && plugcontrol->LookForAreaNumber (local_area) != -1)			a1 = true;		else			a1 = false;				if (forward.zone != -1)			a2 = true;		else			a2 = false;				if (a1 || a2)		{			plugcontrol->retCode = ((a1) ? plugTossMsgEcho : 0) | ((a2) ? plugTossMsgMail : 0);			plugcontrol->putlog ('=', "<CC " RAVELISA "> Installed.");		}		else		{			plugcontrol->retCode = 0;			plugcontrol->putlog ('=', "<CC " RAVELISA "> Wrong preferences file: 'CC.cfg'.");		}		break;			case plugTossMsgEcho:	//	On toss echomail message to _this_ system				plugcontrol->retCode = plugRetContinue;		if (!strcmp ((plugcontrol->messageIn)->toname, nametocmp))		{			plugcontrol->add_to_other (plugcontrol->messageIn, local_area, NULL, NULL);		}				break;		case plugTossMsgMail:	//	On toss netmail message to _this_ system				plugcontrol->retCode = plugRetContinue;		tmpaddr = (plugcontrol->messageIn)->to;		(plugcontrol->messageIn)->to = forward;		(plugcontrol->messageIn)->flags &= ~(MSGHOLD | MSGDIRECT | MSGCRASH);		plugcontrol->RouteMessage (plugcontrol->messageIn, false);		(plugcontrol->messageIn)->to = tmpaddr;				break;		case plugSuicide:		//	Destructive call of plug-ins.			break;			default:				//	We're ignoring all other opCodes (by the way, it's impossible calls)			plugcontrol->retCode = plugRetContinue;		break;	}	ExitCodeResource ();	}