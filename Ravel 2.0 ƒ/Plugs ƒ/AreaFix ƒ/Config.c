#include <string.h>#include "strning.h"#include "Config.h"extern	Boolean	debug;extern	char	local_area[256];static char		*tokens[] = {								"localarea",		//	0								"debug",			//	1								""							};							void ReadTemplates (StringPtr prefname);short fndtoken (char **tt, char *from){	short	res = 0;		while (tt[res][0])		if (!strncasecmp ( from, tt[res], strlen (tt[res]) ))			return res;		else			res++;		return -1;}void pushtojail ( char **storage, char **from ){	char		tmp[512];	short		i;//	while ( **from && **from != 0x0D )//		(*from)++;	if (!**from)	{		*storage = NewPtrClear (1);		return;	}//	(*from)++;	i=0;	while ( **from && **from != '#' && i < 511 )	{		tmp[i++] = **from;		(*from)++;	}	if (**from == '#')	{		tmp[i] = 0;		*storage = NewPtr (i+1);		strcpy ( *storage, tmp );		(*from)++;	}	else		**from = 0;}void pushtoeoln ( char **storage, char **from ){	char		tmp[512];	short		i;	while ( **from && **from == ' ' )		(*from)++;	if (!**from)	{		*storage = NewPtrClear (1);		return;	}		i=0;	while ( **from && **from != 0x0d && i < 511 )	{		tmp[i++] = **from;		(*from)++;	}	if (**from == 0x0d)	{		tmp[i] = 0;		*storage = NewPtr (i+1);		strcpy ( *storage, tmp );		(*from)++;	}	else		**from = 0;}void passtoeoln ( char **from ){	while ( **from && **from != 0xd )		(*from)++;	if (!**from)		return;	(*from)++;}void ReadTemplates (StringPtr prefname){	short		fRefNum, t, tt;	long		len = 0, counter;	Handle		txt;	Ptr			p, ttt;		char		tmp[128];		long		l_1, l_2, l_3, l_4, l_5, l_6;			debug = false;	if ( FSOpen ( prefname, 0, &fRefNum ) )	{		return;	}			GetEOF ( fRefNum, &len );		if (len > 0 && (txt = NewHandle ( len+1 )))	{		counter = len;				HLock (txt);		FSRead ( fRefNum, &counter, *txt );				p = *txt;		p[len] = 0;				while (*p)		{			if (*p == 0x0d)				p++;			else				if (*p != ';')				{					t = fndtoken (tokens, p);										switch (t)					{					case 0:		//	hello												p += strlen (tokens[t]);						pushtoeoln ( &ttt, &p );						strcpy (local_area, ttt);						DisposePtr (ttt);												break;										case 1:											debug = true;					/*	break;	*/										default:	//	all others												passtoeoln (&p);						break;					}				}				else					passtoeoln (&p);		}				DisposeHandle (txt);	}	FSClose ( fRefNum );}