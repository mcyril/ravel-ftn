#include <CommResources.h>#include <CRMSerialDevices.h>#include <Connections.h>#include <CTBUtilities.h>#include <stdio.h>#include <string.h>#include "PatchNewControl.h"#include "PascalStr.h"void	doTCPSetup (void);extern	long	defaultPort, listenPort;	static pascal Boolean setupFilter ( DialogPtr theDialog, EventRecord *theEvent, short *itemHit ){	Boolean 	result = false;	Point		localWhere = theEvent->where;	GrafPtr		savePort;	short		initem, part;	WindowPtr	window;	short		iType;	Handle		iHandle;	Rect		iRect;	switch (theEvent->what)	{	case keyDown:	case autoKey:			part = theEvent->message & 0x00FF;			if (part == 0x03 || part == 0x0D)		{			*itemHit = 1;			result = true;		}		else			if (part == 0x1B)			{				*itemHit = 2;				result = true;			}		break;	}	return result;}void doTCPSetup (void){	DialogPtr	linxDlg;	short		iHit;		GrafPtr		oldPort;	short		iType;	Handle		iHandle;	Rect		iRect;		Str255		tmp;	FontInfo		fi;		GetPort (&oldPort);		PatchNewControl ();	linxDlg = GetNewDialog ( 503, NULL, (WindowPtr) -1L );	UnPatchNewControl ();		SetPort (linxDlg);	TextFont (1);	TextSize (9);		(*(((DialogPeek) linxDlg)->textH))->txFont = 1;	(*(((DialogPeek) linxDlg)->textH))->txSize = 9;	GetFontInfo (&fi);	(*(((DialogPeek) linxDlg)->textH))->lineHeight = fi.ascent + fi.descent + fi.leading;	(*(((DialogPeek) linxDlg)->textH))->fontAscent = fi.ascent;	GetDialogItem (linxDlg, 3, &iType, &iHandle, &iRect);	NumToString (defaultPort, tmp);	SetDialogItemText (iHandle, tmp);	GetDialogItem (linxDlg, 4, &iType, &iHandle, &iRect);	NumToString (listenPort, tmp);	SetDialogItemText (iHandle, tmp);	do {			ModalDialog ( setupFilter, &iHit );		} while (iHit != 1 && iHit != 2);	if (iHit == 1)	{		GetDialogItem (linxDlg, 3, &iType, &iHandle, &iRect);		GetDialogItemText (iHandle, tmp);		StringToNum (tmp, &defaultPort);		GetDialogItem (linxDlg, 4, &iType, &iHandle, &iRect);		GetDialogItemText (iHandle, tmp);		StringToNum (tmp, &listenPort);	}		DisposeDialog (linxDlg);	SetPort (oldPort);}